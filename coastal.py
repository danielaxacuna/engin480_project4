# Coastal Virginia Offshore Wind

# Imports
import numpy as np
import pyproj
from py_wake.site import UniformWeibullSite
from py_wake.wind_turbines import OneTypeWindTurbines
from py_wake.literature.gaussian_models import Bastankhah_PorteAgel_2014
from py_wake.wind_turbines.generic_wind_turbines import GenericWindTurbine


# Define turbine positions
utm_turbines = np.array(
    [
    [-75.46581833850401, 36.82307767145467],
    [-75.45073841078163, 36.82307767145467],
    [-75.43447574363049, 36.82284097830832],
    [-75.41969150076528, 36.82331436386896],
    [-75.39041869989283, 36.838461155544664],
    [-75.40402020332851, 36.82355105555115],
    [-75.40549862761516, 36.83869780036879],
    [-75.42146560990915, 36.838461155544664],
    [-75.43684122248872, 36.83869780036879],
    [-75.4522168350683, 36.83822450998832],
    [-75.46788813250504, 36.83822450998832],
    [-75.3880102512237, 36.823516690796865],
    [-75.37440874778798, 36.83866344241771],
    [-75.3590331352084, 36.83913673008192],
    [-75.34336183777162, 36.83866344241771],
    [-75.37263463864413, 36.82327999900838],
    [-75.35696334120733, 36.823516690796865],
    [-75.34158772862777, 36.82327999900838],
    [-75.3262121160482, 36.82327999900838],
    [-75.32798622519206, 36.83890008661592],
    [-75.31054081861146, 36.823516690796865],
    [-75.33005601919311, 36.8542803888209],
    [-75.31438472175634, 36.85380719488764],
    [-75.2984177394624, 36.8542803888209],
    [-75.28333781174001, 36.854516984689056],
    [-75.26796219916044, 36.854516984689056],
    [-75.3123149277553, 36.83866344241771],
    [-75.29457383631751, 36.823516690796865],
    [-75.29664363031856, 36.83890008661592],
    [-75.28156370259616, 36.83866344241771],
    [-75.2658924051594, 36.83890008661592],
    [-75.25022110772262, 36.83937337281576],
    [-75.27978959345232, 36.82327999900838],
    [-75.26382261115835, 36.823516690796865],
    [-75.24844699857877, 36.82375338185322],
    [-75.23277570114203, 36.82375338185322],
    [-75.21710440370526, 36.82399007217752],
    [-75.23454981028587, 36.83937337281576],
    [-75.21917419770631, 36.83913673008192],
    [-75.23661960428694, 36.854753579824845],
    [-75.25199521686649, 36.854753579824845],
    [-75.22065262199297, 36.854753579824845],
    [-75.2233137857084, 36.870130692719016],
    [-75.23868939828795, 36.870130692719016],
    [-75.25406501086755, 36.870130692719016],
    [-75.2697363083043, 36.86965759692586],
    [-75.28511192088385, 36.870130692719016],
    [-75.30078321832062, 36.870130692719016],
    [-75.31615883090019, 36.86965759692586],
    [-75.46996447813557, 36.85377394475749],
    [-75.45482211658897, 36.85411051194693],
    [-75.43883851273455, 36.85377394475749],
    [-75.42327553003355, 36.85411051194693],
    [-75.40771254733306, 36.85377394475749],
    [-75.39257018578647, 36.85478364188003],
    [-75.37658658193205, 36.854447077654456],
    [-75.36102359923105, 36.854447077654456],
    [-75.34756372230115, 36.86992749813973],
    [-75.33200073960015, 36.86992749813973],
    [-75.33368322421681, 36.885068352984916],
    [-75.3181202415158, 36.885068352984916],
    [-75.33662757229524, 36.9008789297379],
    [-75.32106458959426, 36.900542568587],
    [-75.3050809857398, 36.900542568587],
    [-75.28741489726872, 36.885068352984916],
    [-75.27185191456822, 36.885068352984916],
    [-75.2558683107133, 36.885741210196926],
    [-75.2407259491667, 36.88540478233212],
    [-75.22474234531228, 36.88540478233212],
    [-75.27353439918441, 36.9008789297379],
    [-75.2579714164839, 36.9008789297379],
    [-75.2272660722363, 36.900542568587],
    [-75.47164696275175, 36.869591000607016],
    [-75.45608398005123, 36.869254501592096],
    [-75.44052099735075, 36.869254501592096],
    [-75.42495801465023, 36.869254501592096],
    [-75.40981565310365, 36.869591000607016],
    [-75.39383204924873, 36.869254501592096],
    [-75.37868968770213, 36.869254501592096],
    [-75.36270608384774, 36.869254501592096],
    [-75.47375006852235, 36.88473192215531],
    [-75.45818708582183, 36.8843954898433],
    [-75.44304472427527, 36.8843954898433],
    [-75.46071081274586, 36.900542568587],
    [-75.46197267620809, 36.915004759190396],
    [-75.47837690121695, 36.916013646920405],
    [-75.47963876467921, 36.930809133591424],
    [-75.4817418704498, 36.94627407236926],
    [-75.46828199351938, 36.96139977971697],
    [-75.45608398005123, 36.977866577748244],
    [-75.44136223965857, 36.99298600914922],
    [-75.42537863580415, 36.99231409822937],
    [-75.4527190108189, 36.962071963653855],
    [-75.43715602811788, 36.96173587242761],
    [-75.43925913388848, 36.977530556254834],
    [-75.42369615118798, 36.97719453327764],
    [-75.42159304541738, 36.96173587242761],
    [-75.4661788877488, 36.94627407236926],
    [-75.45061590504828, 36.946610231834015],
    [-75.4350529223478, 36.946610231834015],
    [-75.46449640313261, 36.930809133591424],
    [-75.44851279927819, 36.93114536128401],
    [-75.43294981657719, 36.93148158749345],
    [-75.44683031466153, 36.915677352493574],
    [-75.43126733196101, 36.915341056583785],
    [-75.44514783004533, 36.90020620595338],
    [-75.42916422619093, 36.89986984183716],
    [-75.42748174157424, 36.88473192215531],
    [-75.41191875887372, 36.885068352984916],
    [-75.41402186464433, 36.900542568587],
    [-75.39845888194333, 36.90020620595338],
    [-75.38247527808892, 36.89986984183716],
    [-75.38079279347274, 36.885068352984916],
    [-75.41780745503061, 36.93114536128401],
    [-75.41991056080121, 36.946946389815395],
    [-75.2756375049545, 36.916013646920405],
    [-75.26007452225399, 36.9163499398644],
    [-75.24451153955349, 36.916013646920405],
    [-75.22936917800688, 36.916013646920405],
    [-75.23063104146917, 36.93114536128401],
    [-75.24619402416965, 36.93148158749345],
    [-75.23441663185592, 36.96240805339657],
    [-75.21927427030933, 36.96240805339657],
    [-75.22095675492552, 36.977866577748244],
    [-75.23694035877995, 36.977866577748244],
    [-75.26175700687017, 36.93148158749345],
    [-75.24829712994025, 36.947282546313474],
    [-75.25040023571034, 36.96240805339657],
    [-75.25250334148095, 36.9782025977578],
    [-75.2537652049432, 36.99332196238274],
    [-75.39972074540559, 36.915677352493574],
    [-75.40182385117618, 36.93114536128401],
    [-75.4039269569463, 36.94627407236926],
    [-75.4060300627169, 36.962071963653855],
    [-75.39046708001635, 36.962071963653855],
    [-75.38457838385902, 36.915341056583785],
    [-75.36901540115852, 36.915677352493574],
    [-75.38668148962961, 36.93148158749345],
    [-75.38836397424578, 36.946610231834015],
    [-75.37280099154529, 36.946610231834015],
    [-75.37448347616146, 36.96139977971697],
    [-75.35934111461488, 36.962071963653855],
    [-75.35681738769036, 36.94627407236926],
    [-75.3555555242281, 36.930809133591424],
    [-75.3711185069291, 36.93114536128401],
    [-75.34798137158768, 36.99312138086418],
    [-75.34565815602853, 36.977656723273256],
    [-75.34385121059351, 36.962188922220605],
    [-75.33972104959935, 36.931450233505004],
    [-75.35340220789335, 36.91576666317913],
    [-75.33765596910166, 36.915973046891],
    [-75.3216515952485, 36.91617943004435],
    [-75.3066797616436, 36.915973046891],
    [-75.32423294586971, 36.931450233505004],
    [-75.32629802636737, 36.946924278119425],
    [-75.33223513279657, 36.99312138086418],
    [-75.32991191723744, 36.977656723273256],
    [-75.32810497180243, 36.962188922220605],
    [-75.31055178757569, 36.94713057748605],
    [-75.30848670707861, 36.931450233505004],
    [-75.29506368384666, 36.946924278119425],
    [-75.29299860334957, 36.93165657476824],
    [-75.3123587330107, 36.962395180242765],
    [-75.31442381350843, 36.977862939385815],
    [-75.31674702906756, 36.99312138086418],
    [-75.27776863468259, 36.931450233505004],
    [-75.27957558011761, 36.94713057748605],
    [-75.30048452015173, 36.99312138086418],
    [-75.28525455148477, 36.99332755506062],
    [-75.28318947098767, 36.97745050660188],
    [-75.28164066061471, 36.962188922220605],
    [-75.2640874763886, 36.946924278119425],
    [-75.26589442182362, 36.962395180242765],
    [-75.26770136725864, 36.97806915494],
    [-75.26976644775571, 36.99353372869814]

])




# Transform geographic coordinates to UTM using pyproj
transformer = pyproj.Transformer.from_crs("epsg:4326", "epsg:32619", always_xy=True)
x, y = transformer.transform(utm_turbines[:,1], utm_turbines[:,0])



class Coastal_Verginia(UniformWeibullSite):
    def __init__(self, ti=0.07, shear=None):


        f = [6.96, 8.30, 7.85, 6.38, 6.60, 7.49, 10.75, 11.96, 11.24, 9.86, 9.30, 8.24]
        a = [8.83, 9.76, 8.83, 7.19, 7.55, 8.27, 9.84, 10.87, 9.91, 9.35, 9.00, 7.92]
        k = [2.033, 2.375, 2.252, 1.697, 1.774, 2.067, 2.553, 2.842, 2.264, 2.066, 2.011, 1.774]



        UniformWeibullSite.__init__(self, np.array(f) / np.sum(f), a, k, ti=ti, shear=shear)
        #self.initial_position = np.array([xinit, yinit]).T
        self.name = "Coastal_Verginia"


# site = UniformWeibullSite(p_wd=p_wd, a=weibull_A, k=weibull_k, ti=0.1)

site = Coastal_Verginia()

class SG_140_222_DDde13(GenericWindTurbine):


    def __init__(self):
        """
        Parameters
        ----------
        The turbulence intensity Varies around 6-8%
        Hub Height Site Specific
        """
        #power norm in kW
        GenericWindTurbine.__init__(self, name='SG_140_222_DDde13', diameter=222, hub_height=140,
                             power_norm=14000, turbulence_intensity=0.08)


wind_turbines = SG_140_222_DDde13()


wf_model = Bastankhah_PorteAgel_2014(site, windTurbines=wind_turbines, k=0.0324555)


#aep = wf_model.aep().sum()
aep = wf_model.aep(x, y).sum()


#print('AEP:', aep)
print('AEP:', aep)
