# Revolution SouthFork Wind

# Imports
import numpy as np
import pyproj
from py_wake.site import UniformWeibullSite
from py_wake.wind_turbines import OneTypeWindTurbines
from py_wake.literature.gaussian_models import Bastankhah_PorteAgel_2014
from py_wake.wind_turbines.generic_wind_turbines import GenericWindTurbine


# Define turbine positions
utm_turbines = np.array([
    [41.079862125488916, -70.94746519260981],
    [41.079402038794655, -70.96974329083305],
    [41.07917199423929, -70.99049549191751],
    [41.07871190271413, -71.01460466670713],
    [41.07848185574386, -71.03566204721994],
    [41.07779171000206, -71.0579401454432],
    [41.11504920996393, -70.83851613691448],
    [41.13114159096796, -70.83973685462567],
    [41.130911727594736, -70.86079423513844],
    [41.13114159096796, -70.88307233336168],
    [41.13045199843174, -70.90504525215731],
    [41.113439754833024, -70.9267129915246],
    [41.11366967941035, -70.90474007272972],
    [41.114589369667414, -70.88307233336168],
    [41.1147439372931, -70.86041477831387],
    [41.09659387697937, -70.94855395160042],
    [41.09604273175307, -70.97042885336117],
    [41.11158072285542, -70.99269175013315],
    [41.096730331219135, -70.99214430185248],
    [41.09452998759275, -71.01385975034295],
    [41.09494255763633, -71.03557519883427],
    [41.11130574612224, -71.03758250919869],
    [41.12752740278415, -71.03703506091716],
    [41.14470698792502, -71.03758250919869],
    [41.111030768237356, -71.05893299216844],
    [41.09439246366864, -71.05838554388777],
    [41.162530822623125, -70.97280390137365],
    [41.162393441152915, -70.99433686710418],
    [41.16211867734927, -71.01586983283471],
    [41.16170652948347, -71.03831521236751],
    [41.16115699496427, -71.06021314361875],
    [41.12758807966188, -71.08036010703138],
    [41.14435539194824, -71.08218493463588],
    [41.16056887865332, -71.08236741739579],
    [41.16043150989506, -71.10499527613366],
    [41.177190425258345, -71.1051777588936],
    [41.19367042234987, -71.10609017269586],
    [41.210420834075194, -71.10627265545664],
    [41.2109699553132, -71.06229431019332],
    [41.2109699553132, -71.08437472420452],
    [41.19325005602539, -71.12761472941006],
    [41.17676995312655, -71.12706728112853],
    [41.1600109302002, -71.12688479836774],
    [41.15971837979757, -71.14864729349108],
    [41.15930621683762, -71.17054522474236],
    [41.17579071351565, -71.1712751557838],
    [41.176477477542534, -71.14919474177174],
    [41.15875666219142, -71.19116577667062],
    [41.15738275587256, -71.25867287792119],
    [41.15779493092805, -71.23677494666993],
    [41.15820710339224, -71.21469453265875],
    [41.17524129756356, -71.2154244637002],
    [41.175653360299975, -71.19334404968814],
    [41.191721785125424, -71.21560694646097],
    [41.1922710632802, -71.19389149796966],
    [41.19254570062938, -71.17162860119767],
    [41.1929576544932, -71.14973066994644],
    [41.208745599318576, -71.19406505070884],
    [41.20916000804368, -71.1721467323798],
    [41.225906455083106, -71.1725116979005],
    [41.22631819894784, -71.15079624941004],
    [41.2265926934171, -71.12871583539798],
    [41.22727007752144, -71.10660425418774],
    [41.2275445679947, -71.08470632293648],
    [41.22795630154431, -71.06262590892445]

    
])




# Transform geographic coordinates to UTM using pyproj
transformer = pyproj.Transformer.from_crs("epsg:4326", "epsg:32619", always_xy=True)
x, y = transformer.transform(utm_turbines[:,1], utm_turbines[:,0])



class Revolution_southforkwind(UniformWeibullSite):
    def __init__(self, ti=0.07, shear=None):
        
        f = [6.2745, 7.0711, 7.1255, 6.858, 6.1305, 6.2996, 8.1946, 13.6288, 12.886, 11.569, 10.8333, 8.43]

        a = [8.35, 9.37, 8.84, 7.77, 7.53, 8.26, 9.31, 10.72, 10.37, 9.8, 9.35, 8.15]

        k = [2.096, 2.717, 2.497, 2.017, 1.826, 2.053, 2.677, 2.807, 2.611, 2.5, 2.321, 2.232]



        UniformWeibullSite.__init__(self, np.array(f) / np.sum(f), a, k, ti=ti, shear=shear)
        #self.initial_position = np.array([xinit, yinit]).T
        self.name = "Vineyard Southforkwind"




site = Revolution_southforkwind()

class SG_11_0_200_DD(GenericWindTurbine):


    def __init__(self):
        """
        Parameters
        ----------
        The turbulence intensity Varies around 6-8%
        Hub Height Site Specific
        """
        #power norm in kW
        GenericWindTurbine.__init__(self, name='SG_11_0_200_DD', diameter=200, hub_height=133,
                             power_norm=11000, turbulence_intensity=0.08)


wind_turbines = SG_11_0_200_DD()


wf_model = Bastankhah_PorteAgel_2014(site, windTurbines=wind_turbines, k=0.0324555)


#aep = wf_model.aep().sum()
aep = wf_model.aep(x, y).sum()


#print('AEP:', aep)
print('AEP:', aep)
